% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sim_boin_one_trial.R
\name{sim_boin_one_trial}
\alias{sim_boin_one_trial}
\title{Simulate One BOIN Trial}
\usage{
sim_boin_one_trial(
  target,
  p_true,
  n_doses,
  n_cohort,
  cohort_size,
  decision_table,
  stopping_boundaries,
  n_earlystop = 18,
  min_mtd_sample = 1
)
}
\arguments{
\item{target}{Numeric. The target toxicity probability (e.g., 0.30 for 30\%).}

\item{p_true}{Numeric vector. True toxicity probabilities for each dose level.}

\item{n_doses}{Numeric. Number of doses evaluated.}

\item{n_cohort}{Numeric. Maximum number of cohorts allowed in the trial.}

\item{cohort_size}{Numeric vector or scalar. Number of patients per cohort.
If vector (e.g., c(4, 3, 3)), each element specifies size for corresponding cohort.
If scalar, all cohorts use the same size.}

\item{decision_table}{Character matrix. Decision table from \code{get_boin_decision()}.}

\item{stopping_boundaries}{Character matrix. Trial stopping rule table from \code{get_boin_stopping_boundaries()}.}

\item{n_earlystop}{Numeric. Sample size at current dose triggering trial termination.
Default is 18. Trial stops when this sample size is reached at any dose.}

\item{min_mtd_sample}{Numeric. Minimum number of patients required for a dose to be
considered as MTD candidate. Default is 6.}
}
\value{
A list containing:
\item{n_pts}{Numeric vector. Number of patients treated at each dose}
\item{n_tox}{Numeric vector. Number of DLTs at each dose}
\item{mtd}{Numeric. Selected MTD (dose level) or NA if no dose is suitable}
\item{iso_est}{Numeric vector. Isotonic-adjusted toxicity rate estimates}
\item{reason}{Character. Reason for trial termination}
\item{cohorts_completed}{Numeric. Number of cohorts completed}
}
\description{
Conduct a complete simulation of one dose-finding trial using the BOIN design.
The trial includes dose escalation/de-escalation and MTD selection phases.
Optimized for computational efficiency using matrix indexing and vectorized operations.
}
\details{
The trial proceeds in three main phases:
\enumerate{
\item Dose Escalation/De-escalation: Cohorts are enrolled at the current dose,
and dose adjustments are made based on the decision table.
\item Safety Monitoring: At the lowest dose, if excessive toxicity is observed,
the entire trial is stopped.
\item MTD Selection: After trial completion or early stopping, isotonic regression
is applied to estimate dose-toxicity relationships, and the MTD is selected
as the dose with estimated toxicity rate closest to the target.
}

Reasons for trial termination include:
\itemize{
\item "trial_completed": Normal completion with cohort enrollment
\item "lowest_dose_too_toxic": Safety stopping at lowest dose
\item "lowest_dose_eliminated": Lowest dose eliminated due to toxicity
\item "no_valid_dose": All doses eliminated or insufficient data
}
}
\examples{
\dontrun{
target <- 0.30
p_true <- c(0.10, 0.25, 0.40)
boin_bound <- get_boin_boundary(target)
decision_table <- get_boin_decision(target, boin_bound$lambda_e,
                                boin_bound$lambda_d, 18, 0.95)
stopping_boundaries <- get_boin_stopping_boundaries(target, 18, 0.90)

result <- sim_boin_one_trial(
  target = target,
  p_true = p_true,
  n_doses = 3,
  n_cohort = 10,
  cohort_size = 3,
  decision_table = decision_table,
  stopping_boundaries = stopping_boundaries
)
print(result)
}

}
\references{
Liu S. and Yuan, Y. (2015). Bayesian Optimal Interval Designs for Phase I Clinical
Trials. Journal of the Royal Statistical Society: Series C, 64, 507-523.
}
