% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sim_boin.R
\name{sim_boin}
\alias{sim_boin}
\title{Run BOIN Simulation}
\usage{
sim_boin(
  n_trials = 10000,
  target,
  p_true,
  n_doses,
  n_cohort,
  cohort_size,
  decision_table,
  stopping_boundaries,
  n_earlystop = 18,
  min_mtd_sample = 6,
  seed = 123
)
}
\arguments{
\item{n_trials}{Numeric. Number of trials to simulate. Default is 10000.
Typically 1000-10000 for detailed operating characteristics.}

\item{target}{Numeric. The target toxicity probability (e.g., 0.30 for 30\%).}

\item{p_true}{Numeric vector. True toxicity probabilities for each dose.
Length determines number of doses evaluated.}

\item{n_doses}{Numeric. Number of doses evaluated.}

\item{n_cohort}{Numeric. Maximum number of cohorts per trial.}

\item{cohort_size}{Numeric vector or scalar specifying patients per cohort.
If vector (e.g., c(4, 3, 3)), each element specifies size for corresponding cohort.
If scalar, all cohorts use the same size.}

\item{decision_table}{Character matrix. Decision table from \code{get_boin_decision()}.}

\item{stopping_boundaries}{Character matrix. Trial stopping rule table from
\code{get_boin_stopping_boundaries()}.}

\item{n_earlystop}{Numeric. Sample size triggering early stopping. Default is 18.}

\item{min_mtd_sample}{Numeric. Minimum sample size for MTD consideration. Default is 6.}

\item{seed}{Numeric. Random seed for reproducibility. Default is 123.}
}
\value{
A list containing:
\item{detailed_results}{List of results from each individual trial}
\item{summary}{Aggregated summary statistics from \code{summarize_simulation_boin()}}
}
\description{
Execute multiple BOIN trial simulations using optimized batch processing for
computational efficiency. The function processes all trials simultaneously at
each cohort, dramatically reducing computation time while maintaining identical
results to traditional sequential approaches.

This implementation is particularly beneficial for large-scale simulations
(e.g., 10,000+ trials) where computational efficiency is critical for practical
protocol development and regulatory submissions.
}
\details{
This function implements an optimized approach to BOIN simulation:
\enumerate{
\item Initialize matrices to store state for all trials simultaneously
\item Loop over cohorts (not trials), processing all active trials at each cohort
\item Generate DLT data for all active trials in a single \code{rbinom()} call
\item Apply dose decisions using vectorized matrix operations
\item Perform MTD selection using optimized batch processing
}

The optimized approach reduces the number of iterations from
\code{n_trials * n_cohort} to just \code{n_cohort}, while processing
all trials simultaneously using matrix operations. This typically provides
2-5x speedup compared to traditional sequential loop-based approaches.

\strong{Key Performance Features:}
\itemize{
\item Single random number generation for all trials per cohort
\item Matrix-based decision table lookups via vectorized indexing
\item Batch isotonic regression and MTD selection
\item Early termination of inactive trials to reduce overhead
}

\strong{Memory Usage:} The function maintains \code{n_trials x n_doses} matrices
for patient counts, DLT counts, and elimination status. For typical
simulations (10000 trials, 5-9 doses), memory usage is negligible on
modern systems (<100MB).
}
\examples{
\dontrun{
# Basic BOIN simulation
target <- 0.30
p_true <- c(0.10, 0.25, 0.40, 0.55, 0.70)
n_doses <- 5
boin_bound <- get_boin_boundary(target)
decision_table <- get_boin_decision(
  target = target,
  lambda_e = boin_bound$lambda_e,
  lambda_d = boin_bound$lambda_d,
  max_sample_size = 18,
  cutoff_eli = 0.95
)
stopping_boundaries <- get_boin_stopping_boundaries(
  target = target,
  max_sample_size = 18,
  cutoff_stop = 0.90
)

result <- sim_boin(
  n_trials = 10000,
  target = target,
  p_true = p_true,
  n_doses = n_doses,
  n_cohort = 10,
  cohort_size = 3,
  decision_table = decision_table,
  stopping_boundaries = stopping_boundaries,
  seed = 123
)

# Display summary
print(result$summary)

# Access detailed results
first_trial <- result$detailed_results[[1]]
print(first_trial$n_pts)  # Patients per dose in first trial
print(first_trial$mtd)    # Selected MTD in first trial

# Large-scale simulation for regulatory submission
result_large <- sim_boin(
  n_trials = 100000,
  target = target,
  p_true = p_true,
  n_doses = n_doses,
  n_cohort = 10,
  cohort_size = 3,
  decision_table = decision_table,
  stopping_boundaries = stopping_boundaries,
  seed = 123
)
}

}
\references{
Liu S. and Yuan, Y. (2015). Bayesian Optimal Interval Designs for Phase I Clinical
Trials. Journal of the Royal Statistical Society: Series C, 64, 507-523.
}
\seealso{
\code{\link{get_boin_decision}} for generating decision tables
\code{\link{get_boin_stopping_boundaries}} for generating stopping boundaries
\code{\link{summarize_simulation_boin}} for summarizing simulation results
}
