% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/isotonic_regression.R
\name{.select_mtd_batch}
\alias{.select_mtd_batch}
\title{Batch MTD Selection for Multiple Trials (Internal)}
\usage{
.select_mtd_batch(
  diffs_mat,
  iso_est_mat,
  eliminated_mat,
  cohorts_completed,
  stop_reason,
  target,
  boundMTD = FALSE,
  lambda_d = NULL
)
}
\arguments{
\item{diffs_mat}{Matrix (n_trials x n_doses). Absolute differences between
isotonic estimates and target toxicity rate for each trial.}

\item{iso_est_mat}{Matrix (n_trials x n_doses). Isotonic-adjusted toxicity
rate estimates for each trial.}

\item{eliminated_mat}{Logical matrix (n_trials x n_doses). Whether each dose
has been eliminated in each trial.}

\item{cohorts_completed}{Integer vector (n_trials). Number of cohorts completed
in each trial.}

\item{stop_reason}{Character vector (n_trials). Pre-determined stopping reason
for trials that stopped early (e.g., "lowest_dose_too_toxic").}

\item{target}{Numeric. Target toxicity probability.}

\item{boundMTD}{Logical. If TRUE, impose the condition that the isotonic estimate
of toxicity probability for the selected MTD must be less than the de-escalation
boundary. Default is FALSE.}

\item{lambda_d}{Numeric. De-escalation boundary. Only used if boundMTD = TRUE.}
}
\value{
List with two elements:
\item{mtd}{Integer vector (n_trials). Selected MTD for each trial (or NA)}
\item{reason}{Character vector (n_trials). Reason for trial termination}
}
\description{
Select MTD for multiple trials using optimized batch processing. This is an
internal function used by \code{sim_boin()} for efficient MTD selection across
simulation results.
}
\details{
The function first handles trials with pre-determined stopping reasons that
prevent MTD selection (e.g., safety stopping at lowest dose, lowest dose
eliminated), then applies vectorized operations to determine termination
reasons for remaining trials, and finally loops over valid trials to select
MTD using the standard BOIN tiebreaker rules.

Trials that stopped due to reaching n_earlystop are treated as normally
completed trials and undergo MTD selection.

When boundMTD = TRUE, an additional constraint is applied: the selected MTD's
isotonic-estimated toxicity rate must be strictly less than the de-escalation
boundary (lambda_d). If the initially selected MTD violates this constraint,
the function searches for a lower dose that satisfies the constraint.
}
\keyword{internal}
